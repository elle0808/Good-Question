<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>好問題！ - 最新問題</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    // 自定義配置：確保顏色和圓角精準還原設計稿
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    //
                    'custom-light-yellow': '#FFFFFF', 
                    // 卡片邊框、分隔線條的鮮黃色
                    'custom-accent-yellow': '#F0E36E',  
                    // 頂部按鈕、標題點綴的橘色
                    'custom-accent-orange': '#854D0C',
                    // 頁腳、內文分隔線的深棕色
                    'custom-dark-brown': '#4D3110',      
                },
                borderRadius: {
                    'xl-2': '16px', // 卡片圓角
                },
                borderWidth:{
                    'thick':'6px'
                }
            }
        }
    }
</script>
    </head>
<body class="font-sans text-gray-800 bg-white">
  <!-- 導覽列 -->
  <header class="font-['Roboto:Regular'] bg-[#F0E36E] flex justify-between items-center px-6 py-3">
    <h1 class="text-lg font-bold text-[#854D0C]"><a href="index.html">好問題！</a></h1>
    <nav class="flex items-center space-x-6">
      <a href="list.html" class="text-[#854D0C] hover:text-[#FF9925] duration-300">最新問題</a>
      <button class="bg-[#F79C33] text-white px-4 py-1.5 rounded-lg hover:bg-[#F9BB48] duration-300 transition">登入 / 註冊</button>
    </nav>
  </header>

    <main class="min-h-screen max-w-6xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
        <div class="flex items-center mb-8">
            <div class="w-2 h-6 bg-[#F0E36E] mr-2"></div>
            <h2 class="text-2xl font-semibold text-gray-800">問題列表</h2>
        </div>

        <div id="question-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

            <article class="bg-custom-light-yellow rounded-xl-2 p-[10px] border-thick border-custom-accent-yellow /50 hover:transform transition duration-300  hover:-translate-y-1 bg-blue-500 text-white py-3 px-4 roundedcursor-pointer">
                <h3 class="text-xl font-bold text-gray-800 mb-2 pb-2 border-b-2 border-custom-dark-brown">
                    標題
                </h3>
                
                <p class="text-gray-700 mb-4 line-clamp-3">
                    內文... 這裡是問題的簡短描述，應從後台取得並限制長度。
                </p>
                
                <div class="text-sm text-gray-500">
                    <span class="inline-block bg-custom-accent-yellow/30 text-custom-dark-brown px-3 py-1 rounded-full text-xs font-medium">#標籤</span>
                </div>
            </article>
             <article class="bg-custom-light-yellow rounded-xl-2 p-[10px] border-thick border-custom-accent-yellow /50 hover:transform transition duration-300  hover:-translate-y-1 bg-blue-500 text-white py-3 px-4 roundedcursor-pointer">
                <h3 class="text-xl font-bold text-gray-800 mb-2 pb-2 border-b-2 border-custom-dark-brown">
                    標題
                </h3>
                <p class="text-gray-700 mb-4 line-clamp-3">
                    內文... 這裡是問題的簡短描述，應從後台取得並限制長度。
                </p>
                <div class="text-sm text-gray-500">
                    <span class="inline-block bg-custom-accent-yellow/30 text-custom-dark-brown px-3 py-1 rounded-full text-xs font-medium">#標籤</span>
                </div>
            </article>

            </div>
    </main>
    <!-- Dialog -->
  <dialog id="loginDialog" class="backdrop:bg-black/60 backdrop:backdrop-blur-sm bg-transparent focus:outline-none">
    <div
      class="relative bg-white border-[#f0e36e] border-[6px] rounded-[40px] md:rounded-[80px] h-auto min-h-[60vh] w-[90vw] max-w-[500px] overflow-hidden shadow-2xl scale-95 transition-transform duration-300 p-8 flex flex-col items-center"
      id="modalContent">
      <h2 class="mt-8 mb-10 font-bold text-[#f19124] text-4xl md:text-5xl select-none text-center">
        登入
      </h2>
      <div class="w-full space-y-6 flex flex-col items-center">
        <div
          class="w-full h-16 md:h-20 flex items-center px-6 bg-white border-[#f0e36e] border-[4px] rounded-full transition-all focus-within:border-[#f19124]">
          <label class="text-[#f19124] text-lg md:text-xl shrink-0 select-none">帳號：</label>
          <input type="text" id="username" name="username"
            class="flex-1 bg-transparent text-lg md:text-xl text-[#b16208] focus:outline-none focus:ring-0 px-2
            placeholder="請輸入帳號(email)" />
        </div>
        <div
          class="w-full h-16 md:h-20 flex items-center px-6 bg-white border-[#f0e36e] border-[4px] rounded-full transition-all focus-within:border-[#f19124]">
          <label class="text-[#f19124] text-lg md:text-xl shrink-0 select-none">密碼：</label>
          <input type="password" id="password" name="password"
            class="flex-1 bg-transparent text-lg md:text-xl text-[#b16208] focus:outline-none focus:ring-0 px-2" />
        </div>
        <div class="flex gap-6 mt-2">
          <button class="text-[#b16208] text-base md:text-lg hover:text-[#f19124] transition-colors">註冊</button>
          <button class="text-[#b16208] text-base md:text-lg hover:text-[#f19124] transition-colors">忘記密碼?</button>
        </div>
        <button
          class="w-3/4 h-14 md:h-16 mt-6 bg-[#F0E36E] rounded-full text-[#b16208] text-xl md:text-2xl font-semibold hover:bg-[#F8EF9A] active:scale-95 transition-all shadow-md">
          登入
        </button>
      </div>

    </div>
  </dialog>

  <script>
    const modal = document.getElementById('loginDialog');

    function openLoginModal() {
      modal.showModal();
      // 讓視窗出現時有一點點放大效果
      document.getElementById('modalContent').classList.remove('scale-95');
      document.getElementById('modalContent').classList.add('scale-100');
    }

    function closeLoginModal() {
      modal.close();
      document.getElementById('modalContent').classList.add('scale-95');
      document.getElementById('modalContent').classList.remove('scale-100');
    }

    // 點擊背景遮罩關閉
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeLoginModal();
      }
    });
  </script>
<script>
    const POSTS_API_URL = '/api/posts'; 
    
    // 獲取正確的DOM元素
    // 注意：請確保您的 HTML 容器 ID 是 'question-list'，如果不是，請將這裡的 ID 修正為正確的。
    const container = document.getElementById('question-list'); 
    
    // 假設您在 HTML 中為載入訊息設置了這個 ID (如果沒有，可以移除 loadingMessage 相關的程式碼)
    const loadingMessage = document.getElementById('loading-message'); 

    /**
     * 檢查圖片 URL 是否有效，並返回圖片 HTML
     * 由於您的後端模型是可選圖片，我們需要檢查 URL 是否存在。
     * @param {string|null|undefined} imageUrl - 圖片 URL
     * @returns {string} - 返回 <img> 標籤或空字串
     */
    function renderImage(imageUrl, title) {
        if (imageUrl && imageUrl.trim() !== '') {
            // 如果 URL 存在且非空，則渲染圖片
            return `
                <div class="mb-3 h-40 bg-gray-300 rounded-lg overflow-hidden">
                    <img 
                        src="${imageUrl}" 
                        alt="${title}" 
                        onerror="this.onerror=null; this.src='https://via.placeholder.com/300x160/${'FDF9E8'.substring(1)}/${'4D3110'.substring(1)}?text=無圖片';" 
                        class="w-full h-full object-cover"
                    >
                </div>
            `;
        }
        return ''; // 否則返回空字串，不顯示圖片
    }

    /**
     * 根據單篇文章資料生成對應的HTML字串
     */
    function createCardHTML(post, summary) {
        
        // 渲染圖片 (如果存在)
        const imageHtml = renderImage(post.image_url, post.title);

        // 卡片樣式
        return `
            <article 
                class="bg-custom-light-yellow rounded-xl-2 p-[10px] border-thick border-custom-accent-yellow shadow-md shadow-custom-accent-yellow/50 hover:transform transition duration-300 hover:-translate-y-1 cursor-pointer"
                onclick="window.location.href='./post.html?slug=${post.slug}'" 
            >
                ${imageHtml}
                
                <h3 class="text-xl font-bold text-gray-800 mb-2 pb-2 border-b-2 border-custom-dark-brown">
                    ${post.title}
                </h3>
                
                <p class="text-gray-700 mb-4 line-clamp-3">
                    ${summary}
                </p>
                
                <div class="text-sm text-gray-500 space-x-2">
                     <span class="inline-block bg-custom-accent-yellow/30 text-custom-dark-brown px-3 py-1 rounded-full text-xs font-medium">
                #${post.slug}</span>
                </div>
            </article>
        `;
    }

    /**
     * 獲取資料並渲染的核心邏輯
     */
    async function fetchAndRenderPosts() {
        // 移除載入訊息
        if (loadingMessage) {
            loadingMessage.remove();
        }

        if (!container) {
            console.error("DOM 容器 'question-list' 未找到。請檢查 HTML ID。");
            return;
        }

        try {
            // 執行 fetch 請求
            const response = await fetch(POSTS_API_URL);
            
            if (!response.ok) {
                throw new Error(`API 請求失敗: 狀態碼 ${response.status}. 請確認後端是否啟動。`);
            }

            // 假設 API 直接返回文章列表陣列
            const posts = await response.json();

            if (posts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-lg p-4">目前沒有問題，快來發問吧！</p>';
                return;
            }

            // 遍歷數據並生成 HTML
            const cardsHTML = posts.map(post => {
                // 摘要：取content的前幾個字
                const fullContent = post.content || ""; 
                // 修正：您的摘要邏輯已經在 map 內部，但為了防止潛在的錯誤，我們確保 post.content 存在。
                const summary = fullContent.substring(0, 30) + (fullContent.length > 30 ? '...' : '');

                // 呼叫創建卡片函數，並傳入計算好的 summary
                return createCardHTML(post, summary);
            }).join('');

            // 插入到 DOM 中
            container.innerHTML = cardsHTML;

        } catch (error) {
            console.error("載入文章失敗:", error);
            // 顯示錯誤訊息
            container.innerHTML = `<p class="text-red-600 text-lg p-4">載入文章失敗。錯誤: ${error.message}</p>`;
        }
    }

    // 頁面載入後執行
    document.addEventListener('DOMContentLoaded', fetchAndRenderPosts);
</script>
</body>

</html>







