<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章頁</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-[#FFFFFF] min-h-screen">

  <header class="font-['Roboto:Regular'] bg-[#F0E36E] flex justify-between items-center px-6 py-3">
    <h1 class="text-lg font-bold text-[#854D0C]">好問題！</h1>
    <nav class="flex items-center space-x-6">
      <a href="list.html" class="text-[#854D0C] hover:text-[#FF9925] duration-500">最新問題</a>
      <button class="bg-[#F79C33] text-white px-4 py-1.5 rounded-lg hover:bg-[#F9BB48] duration-500 transition">登入 / 註冊</button>
    </nav>
  </header>

    <main class="container mx-auto p-4 max-w-7xl">
        
        <section id="article-container" class="bg-white p-6 rounded-[25px] mb-6 border-[3px] border-[#F0E36E]">
            <h1 class="text-2xl font-bold mb-2" id="article-title">載入中...</h1>
            
            <div class="h-1 bg-[#854D0C] mb-4"></div>

            <div class="flex items-center text-sm text-gray-500 space-x-4 mb-4">
                <span class="flex items-center">
                    <i class="fas fa-user-circle mr-1 text-gray-600"></i> <span id="article-author"></span>
                </span>
                <span id="article-time"></span>
            </div>
            
            <div class="min-h-[120px] text-gray-800 leading-relaxed pt-2" id="article-content"></div>
            
            <div class="mt-4" id="article-tags-container"></div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <section class="lg:col-span-2">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">回答</h2>

                <div class="bg-white p-2 rounded-[50px] border-[3px] border-[#F0E36E] mb-4">
                    <input type="text" placeholder="我要回答..." class="w-full p-2 border-none bg-transparent placeholder-gray-400 focus:outline-none text-gray-800">
                </div>

                <div id="answers-container">
                    </div>
            </section>

            <aside class="lg:col-span-1">
                <h3 class="text-xl font-bold mb-4 text-gray-800">
                    類似問題
                </h3>
                <div id="similar-questions-container" class="space-y-4">
                    </div>
            </aside>
        </div>
    </main>

   <script>
    // === 設定 ===
    const API_BASE_URL = "/api/posts"; 
    const urlParams = new URLSearchParams(window.location.search);
    const postSlug = urlParams.get('slug'); 
    
    // ----------------------------------------------------
    // [渲染函數 - 保持不變]
    // ----------------------------------------------------
    function renderArticle(article) {
        // ... (保持原樣，這裡需要 article 物件) ...
        document.getElementById('article-title').textContent = article.title;
        document.getElementById('article-author').textContent = article.author || '匿名作者';
        document.getElementById('article-time').textContent = article.time;
        document.getElementById('article-content').innerHTML = article.content ? article.content.replace(/\n/g, '<br>') : '沒有內容'; 

        const tagsContainer = document.getElementById('article-tags-container');
        tagsContainer.innerHTML = '';
        if (article.tags && Array.isArray(article.tags)) {
            article.tags.forEach(tag => {
                const tagSpan = document.createElement('span');
                tagSpan.className = 'inline-block text-gray-500 text-sm mr-2';
                tagSpan.textContent = `#${tag}`;
                tagsContainer.appendChild(tagSpan);
            });
        }
    }

    function renderAnswers(answers) {
        // ... (保持原樣，這裡需要 answers 陣列) ...
        const container = document.getElementById('answers-container');
        container.innerHTML = ''; 
        if (!answers || answers.length === 0) {
             container.innerHTML = '<p class="text-gray-500 p-5">目前沒有人回答，搶頭香吧！</p>';
             return;
        }
        // ... (渲染回答項目的邏輯) ...
        answers.forEach(answer => {
            const answerDiv = `
                <div class="bg-white p-5 rounded-[25px] border-[3px] border-[#F0E36E] mb-4">
                    <div class="flex items-center text-sm text-gray-500 space-x-4 mb-2">
                        <span class="flex items-center">
                            <i class="fas fa-user-circle mr-1 text-gray-600"></i> ${answer.author || '匿名'}
                        </span>
                        <span>${answer.time}</span>
                    </div>
                    <div class="text-gray-700">
                        ${answer.content}
                    </div>
                </div>
            `;
            container.innerHTML += answerDiv;
        });
    }

    function renderSimilarQuestions(questions) {
        // ... (保持原樣，這裡需要 similar_questions 陣列) ...
        const container = document.getElementById('similar-questions-container');
        container.innerHTML = '';
        if (!questions || questions.length === 0) {
             container.innerHTML = '<p class="text-gray-500 p-3">沒有找到類似問題。</p>';
             return;
        }
        // ... (渲染類似問題項目的邏輯) ...
        questions.forEach(q => {
            const tagsHtml = q.tags.map(tag => 
                `<span class="inline-block text-gray-500 text-sm mr-1">#${tag}</span>`
            ).join('');

            const questionDiv = `
                <div class="rounded-[20px] px-4 py-3 border-[3px] border-[#F0E36E]">
                    <h4 class="text-lg font-semibold text-gray-700">${q.title}</h4>
                    <p class="text-sm text-gray-600 mb-2">${q.excerpt}</p>
                    <div class="h-0.5 bg-[#854D0C] w-1/3 my-2"></div>
                    <div class="mt-2">
                        ${tagsHtml}
                    </div>
                </div>
            `;
            container.innerHTML += questionDiv;
        });
    }
    
    // ----------------------------------------------------
    // 主函數：獲取資料並渲染的核心邏輯 (已修正)
    // ----------------------------------------------------
    async function loadPostData() {
        if (!postSlug) {
            document.getElementById('article-title').textContent = "⚠️ 缺少文章 Slug";
            document.getElementById('article-content').textContent = "請在 URL 中提供 ?slug=xxx 參數。";
            return;
        }

        const apiUrl = `${API_BASE_URL}/${postSlug}`; 

        document.getElementById('article-title').textContent = "正在載入文章...";
        document.getElementById('article-content').innerHTML = "請稍候...";


        try {
            const response = await fetch(apiUrl);
            
            if (!response.ok) {
                throw new Error(`API 請求失敗，狀態碼: ${response.status}.`);
            }

            // 核心修正：API 返回的是單個文章物件，所以 data 就是文章物件
            const articleData = await response.json(); 
            
            // --- 執行渲染 ---
            
            // 1. 渲染文章：直接使用 API 返回的物件
            renderArticle(articleData); 
            
            // 2. 渲染回答：因為 API 只返回文章，這裡我們模擬一個空的回答列表
            //    (如果您有單獨的 API /api/posts/{slug}/comments，您需要再次呼叫)
            //    如果您的 PostResponse 包含了 comments/answers，則使用 articleData.comments/articleData.answers
            const dummyAnswers = [
                { author: articleData.author, content: "文章已載入，但回答列表需要單獨的 API 數據。", time: "現在" }
            ];
            renderAnswers(articleData.comments || articleData.answers || dummyAnswers); // 嘗試使用 PostResponse 中的屬性

            // 3. 渲染類似問題：這裡也必須是模擬的，因為單個文章 API 沒提供這個數據
            const dummySimilar = [
                 { title: "無法獲取相關數據", excerpt: "請修改後端路由來一次性返回全部數據。", tags: ["後端", "API"] }
            ];
            renderSimilarQuestions(articleData.similar_posts || articleData.related || dummySimilar); // 嘗試使用 PostResponse 中的屬性
            
        } catch (error) {
            console.error("載入文章失敗:", error);
            
            document.getElementById('article-title').textContent = `⚠️ 文章載入失敗 (Slug: ${postSlug})`;
            document.getElementById('article-content').innerHTML = 
                `無法從伺服器獲取數據。<br>錯誤詳情: ${error.message}`;
        }
    }

    document.addEventListener('DOMContentLoaded', loadPostData);
</script>
</body>

</html>


